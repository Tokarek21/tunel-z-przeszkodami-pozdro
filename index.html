<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
let user = { nick: "", highScore: 0, streak: 0, lastDate: "", history: [] };
let score = 0, gameActive = false, isPaused = false, obstacles = [];
let player = { x: 100, y: 0, size: 20, targetY: 0 };

// Inicjalizacja
function initProfile() {
    const saved = localStorage.getItem('skyDashUser');
    if (saved) {
        user = JSON.parse(saved);
        checkStreak();
        showMenu('death-box');
    }
    updateUI();
}

function showMenu(menuId) {
    document.getElementById('overlay').style.display = 'flex';
    document.getElementById('login-box').style.display = 'none';
    document.getElementById('death-box').style.display = 'none';
    document.getElementById('pause-box')?.remove(); // Usuń stary pause jeśli był

    if (menuId === 'pause') {
        const pauseHtml = `
            <div id="pause-box" class="modal">
                <h2>PAUZA</h2>
                <p>Odpocznij chwilę, pilotie.</p>
                <button onclick="resumeGame()">Kontynuuj</button>
                <button onclick="location.reload()" style="background:#ff4d4d">Wyjdź do menu</button>
            </div>`;
        document.getElementById('overlay').insertAdjacentHTML('beforeend', pauseHtml);
    } else {
        document.getElementById(menuId).style.display = 'block';
    }
    canvas.style.cursor = 'default';
}

function startGame() {
    document.getElementById('overlay').style.display = 'none';
    score = 0; obstacles = []; gameActive = true; isPaused = false;
    player.y = canvas.height / 2;
    canvas.style.cursor = 'none';
    updateUI();
    spawnObstacle();
    requestAnimationFrame(gameLoop);
}

function resumeGame() {
    isPaused = false;
    document.getElementById('overlay').style.display = 'none';
    canvas.style.cursor = 'none';
    requestAnimationFrame(gameLoop);
}

// Obsługa klawisza Escape
window.addEventListener('keydown', (e) => {
    if (e.key === "Escape" && gameActive) {
        isPaused = !isPaused;
        if (isPaused) {
            showMenu('pause');
        } else {
            resumeGame();
        }
    }
});

function gameLoop() {
    if (!gameActive || isPaused) return;

    ctx.fillStyle = 'rgba(5, 5, 5, 0.3)';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    player.y += (player.targetY - player.y) * 0.15;
    ctx.fillStyle = '#00d2ff';
    ctx.beginPath();
    ctx.arc(player.x, player.y, player.size/2, 0, Math.PI*2);
    ctx.fill();

    for (let i = obstacles.length - 1; i >= 0; i--) {
        let o = obstacles[i];
        o.x -= o.speed;
        ctx.fillStyle = '#ff4d4d';
        ctx.fillRect(o.x, o.y, o.w, o.h);

        if (player.x + 10 > o.x && player.x - 10 < o.x + o.w &&
            player.y + 10 > o.y && player.y - 10 < o.y + o.h) {
            gameOver();
        }
        if (o.x + o.w < 0) { obstacles.splice(i, 1); score++; updateUI(); }
    }
    requestAnimationFrame(gameLoop);
}

// Pozostałe funkcje (updateUI, saveProfile, checkStreak, spawnObstacle) zostają bez zmian
// ... (Skopiuj je z poprzedniej wiadomości, żeby kod był kompletny)
</script>
