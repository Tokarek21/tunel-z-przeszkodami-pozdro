<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sky Dash - Twoje Statystyki</title>
    <style>
        body { margin: 0; overflow: hidden; background: #050505; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; color: white; cursor: crosshair; }
        canvas { display: block; }
        
        /* Interfejs */
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; padding: 20px; pointer-events: none; display: flex; justify-content: space-between; }
        .stat-box { background: rgba(0,0,0,0.6); padding: 10px 20px; border-radius: 8px; border: 1px solid #333; }
        
        /* Menu / Overlay */
        #overlay {
            position: absolute; inset: 0; background: rgba(0,0,0,0.85);
            display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 10;
        }
        .modal {
            background: #1a1a1a; padding: 30px; border-radius: 15px; border: 2px solid #00d2ff;
            text-align: center; max-width: 400px; width: 90%;
        }
        input { padding: 10px; border-radius: 5px; border: none; width: 80%; margin: 10px 0; font-size: 16px; }
        button {
            padding: 12px 25px; font-size: 18px; cursor: pointer; background: #00d2ff;
            border: none; color: black; border-radius: 5px; font-weight: bold; transition: 0.3s;
        }
        button:hover { background: #0095b5; transform: scale(1.05); }

        /* Historia i Leaderboard */
        .history-list { text-align: left; font-size: 14px; margin-top: 15px; color: #aaa; }
        .streak-fire { color: #ff4500; font-weight: bold; }
    </style>
</head>
<body>

<div id="ui-layer">
    <div class="stat-box">
        Gracz: <span id="display-nick">...</span><br>
        Najlepszy: <b id="display-highscore">0</b>
    </div>
    <div class="stat-box">
        Streak: <span class="streak-fire">ðŸ”¥ <span id="display-streak">0</span> dni</span><br>
        Wynik: <b id="current-score">0</b>
    </div>
</div>

<div id="overlay">
    <div id="login-box" class="modal">
        <h2>Witaj Pilotie!</h2>
        <p>Podaj swÃ³j nick, aby zapisywaÄ‡ historiÄ™:</p>
        <input type="text" id="nick-input" placeholder="TwÃ³j Nick..." maxlength="15">
        <br>
        <button onclick="saveProfile()">Zacznij GrÄ™</button>
    </div>

    <div id="death-box" class="modal" style="display: none;">
        <h1 style="color: #ff4d4d;">KRACH!</h1>
        <p>TwÃ³j wynik: <span id="final-score">0</span></p>
        <div class="history-list" id="history-container"></div>
        <br>
        <button onclick="startGame()">LeÄ‡ Ponownie</button>
    </div>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

// Dane uÅ¼ytkownika (LocalStorage)
let user = {
    nick: "",
    highScore: 0,
    streak: 0,
    lastDate: "",
    history: []
};

// Inicjalizacja profilu
function initProfile() {
    const saved = localStorage.getItem('skyDashUser');
    if (saved) {
        user = JSON.parse(saved);
        checkStreak();
        showDeathScreen(false); // PokaÅ¼ ekran startowy z historiÄ…
        document.getElementById('login-box').style.display = 'none';
        document.getElementById('death-box').style.display = 'block';
    }
    updateUI();
}

function saveProfile() {
    const input = document.getElementById('nick-input').value;
    if (input.length < 3) return alert("Nick musi mieÄ‡ min. 3 znaki!");
    user.nick = input;
    localStorage.setItem('skyDashUser', JSON.stringify(user));
    startGame();
}

function checkStreak() {
    const today = new Date().toDateString();
    const yesterday = new Date();
    yesterday.setDate(yesterday.getDate() - 1);

    if (user.lastDate === yesterday.toDateString()) {
        user.streak++;
        user.lastDate = today;
    } else if (user.lastDate !== today) {
        user.streak = 1;
        user.lastDate = today;
    }
    localStorage.setItem('skyDashUser', JSON.stringify(user));
}

// --- LOGIKA GRY ---
let score = 0;
let gameActive = false;
let obstacles = [];
let player = { x: 100, y: 0, size: 20, targetY: 0 };

function startGame() {
    document.getElementById('overlay').style.display = 'none';
    score = 0;
    obstacles = [];
    gameActive = true;
    player.y = canvas.height / 2;
    updateUI();
    spawnObstacle();
    requestAnimationFrame(gameLoop);
}

function gameOver() {
    gameActive = false;
    user.history.unshift(score);
    user.history = user.history.slice(0, 5); // Tylko 5 ostatnich
    if (score > user.highScore) user.highScore = score;
    
    localStorage.setItem('skyDashUser', JSON.stringify(user));
    showDeathScreen(true);
}

function showDeathScreen(isDead) {
    document.getElementById('overlay').style.display = 'flex';
    document.getElementById('login-box').style.display = 'none';
    document.getElementById('death-box').style.display = 'block';
    document.getElementById('final-score').innerText = score;
    
    const histCont = document.getElementById('history-container');
    histCont.innerHTML = "<b>Ostatnie loty:</b><br>" + user.history.map(s => `â€¢ Wynik: ${s}`).join('<br>');
    updateUI();
}

function updateUI() {
    document.getElementById('display-nick').innerText = user.nick || "???";
    document.getElementById('display-highscore').innerText = user.highScore;
    document.getElementById('display-streak').innerText = user.streak;
    document.getElementById('current-score').innerText = score;
}

// ObsÅ‚uga pÅ‚Ã³tna
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
window.addEventListener('mousemove', e => player.targetY = e.clientY);

function spawnObstacle() {
    if (!gameActive) return;
    obstacles.push({
        x: canvas.width,
        y: Math.random() * canvas.height,
        w: 30 + Math.random() * 40,
        h: 30 + Math.random() * 40,
        speed: 5 + (score / 10)
    });
    setTimeout(spawnObstacle, 1000 - Math.min(score * 5, 700));
}

function gameLoop() {
    if (!gameActive) return;
    ctx.fillStyle = 'rgba(5, 5, 5, 0.3)';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Gracz
    player.y += (player.targetY - player.y) * 0.15;
    ctx.fillStyle = '#00d2ff';
    ctx.shadowBlur = 20; ctx.shadowColor = '#00d2ff';
    ctx.beginPath();
    ctx.arc(player.x, player.y, player.size/2, 0, Math.PI*2);
    ctx.fill();
    ctx.shadowBlur = 0;

    // Przeszkody
    for (let i = obstacles.length - 1; i >= 0; i--) {
        let o = obstacles[i];
        o.x -= o.speed;
        ctx.fillStyle = '#ff4d4d';
        ctx.fillRect(o.x, o.y, o.w, o.h);

        // Kolizja
        if (player.x + 10 > o.x && player.x - 10 < o.x + o.w &&
            player.y + 10 > o.y && player.y - 10 < o.y + o.h) {
            gameOver();
        }

        if (o.x + o.w < 0) {
            obstacles.splice(i, 1);
            score++;
            document.getElementById('current-score').innerText = score;
        }
    }
    requestAnimationFrame(gameLoop);
}

initProfile();
</script>
</body>
</html>
